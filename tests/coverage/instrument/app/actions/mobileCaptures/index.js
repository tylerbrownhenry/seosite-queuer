
var __cov_tDs8aMzJqqON2ifzOf8wgA = (Function('return this'))();
if (!__cov_tDs8aMzJqqON2ifzOf8wgA.__coverage__) { __cov_tDs8aMzJqqON2ifzOf8wgA.__coverage__ = {}; }
__cov_tDs8aMzJqqON2ifzOf8wgA = __cov_tDs8aMzJqqON2ifzOf8wgA.__coverage__;
if (!(__cov_tDs8aMzJqqON2ifzOf8wgA['app/actions/mobileCaptures/index.js'])) {
   __cov_tDs8aMzJqqON2ifzOf8wgA['app/actions/mobileCaptures/index.js'] = {"path":"app/actions/mobileCaptures/index.js","s":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":1,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":1,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":1,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0},"fnMap":{"1":{"name":"saveImage","line":19,"loc":{"start":{"line":19,"column":0},"end":{"line":19,"column":60}}},"2":{"name":"(anonymous_2)","line":23,"loc":{"start":{"line":23,"column":28},"end":{"line":23,"column":40}}},"3":{"name":"(anonymous_3)","line":26,"loc":{"start":{"line":26,"column":34},"end":{"line":26,"column":55}}},"4":{"name":"(anonymous_4)","line":27,"loc":{"start":{"line":27,"column":46},"end":{"line":27,"column":66}}},"5":{"name":"doit","line":39,"loc":{"start":{"line":39,"column":0},"end":{"line":39,"column":42}}},"6":{"name":"scrot","line":51,"loc":{"start":{"line":51,"column":5},"end":{"line":51,"column":38}}},"7":{"name":"(anonymous_7)","line":53,"loc":{"start":{"line":53,"column":32},"end":{"line":53,"column":46}}},"8":{"name":"(anonymous_8)","line":54,"loc":{"start":{"line":54,"column":53},"end":{"line":54,"column":69}}},"9":{"name":"(anonymous_9)","line":60,"loc":{"start":{"line":60,"column":39},"end":{"line":60,"column":57}}},"10":{"name":"(anonymous_10)","line":63,"loc":{"start":{"line":63,"column":51},"end":{"line":63,"column":66}}},"11":{"name":"(anonymous_11)","line":70,"loc":{"start":{"line":70,"column":28},"end":{"line":70,"column":43}}},"12":{"name":"(anonymous_12)","line":78,"loc":{"start":{"line":78,"column":23},"end":{"line":78,"column":35}}},"13":{"name":"(anonymous_13)","line":81,"loc":{"start":{"line":81,"column":26},"end":{"line":81,"column":38}}},"14":{"name":"(anonymous_14)","line":87,"loc":{"start":{"line":87,"column":36},"end":{"line":87,"column":51}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":29}},"2":{"start":{"line":3,"column":0},"end":{"line":3,"column":29}},"3":{"start":{"line":4,"column":0},"end":{"line":4,"column":21}},"4":{"start":{"line":5,"column":0},"end":{"line":5,"column":45}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":38}},"6":{"start":{"line":8,"column":0},"end":{"line":8,"column":46}},"7":{"start":{"line":19,"column":0},"end":{"line":37,"column":1}},"8":{"start":{"line":20,"column":5},"end":{"line":20,"column":32}},"9":{"start":{"line":21,"column":5},"end":{"line":21,"column":41}},"10":{"start":{"line":22,"column":5},"end":{"line":22,"column":53}},"11":{"start":{"line":23,"column":5},"end":{"line":36,"column":8}},"12":{"start":{"line":24,"column":10},"end":{"line":35,"column":18}},"13":{"start":{"line":27,"column":20},"end":{"line":34,"column":23}},"14":{"start":{"line":28,"column":25},"end":{"line":32,"column":26}},"15":{"start":{"line":29,"column":30},"end":{"line":29,"column":44}},"16":{"start":{"line":31,"column":30},"end":{"line":31,"column":48}},"17":{"start":{"line":33,"column":25},"end":{"line":33,"column":38}},"18":{"start":{"line":39,"column":0},"end":{"line":109,"column":1}},"19":{"start":{"line":40,"column":5},"end":{"line":40,"column":29}},"20":{"start":{"line":41,"column":5},"end":{"line":41,"column":30}},"21":{"start":{"line":42,"column":5},"end":{"line":42,"column":90}},"22":{"start":{"line":43,"column":5},"end":{"line":45,"column":6}},"23":{"start":{"line":44,"column":10},"end":{"line":44,"column":29}},"24":{"start":{"line":46,"column":5},"end":{"line":46,"column":23}},"25":{"start":{"line":47,"column":5},"end":{"line":47,"column":51}},"26":{"start":{"line":48,"column":5},"end":{"line":48,"column":49}},"27":{"start":{"line":49,"column":5},"end":{"line":49,"column":32}},"28":{"start":{"line":51,"column":5},"end":{"line":85,"column":6}},"29":{"start":{"line":52,"column":10},"end":{"line":52,"column":35}},"30":{"start":{"line":53,"column":10},"end":{"line":84,"column":12}},"31":{"start":{"line":54,"column":15},"end":{"line":83,"column":17}},"32":{"start":{"line":55,"column":20},"end":{"line":58,"column":23}},"33":{"start":{"line":59,"column":20},"end":{"line":59,"column":46}},"34":{"start":{"line":60,"column":20},"end":{"line":77,"column":23}},"35":{"start":{"line":61,"column":25},"end":{"line":61,"column":48}},"36":{"start":{"line":62,"column":25},"end":{"line":62,"column":84}},"37":{"start":{"line":63,"column":25},"end":{"line":76,"column":28}},"38":{"start":{"line":64,"column":30},"end":{"line":69,"column":33}},"39":{"start":{"line":71,"column":30},"end":{"line":75,"column":33}},"40":{"start":{"line":79,"column":20},"end":{"line":79,"column":42}},"41":{"start":{"line":82,"column":20},"end":{"line":82,"column":40}},"42":{"start":{"line":87,"column":5},"end":{"line":107,"column":8}},"43":{"start":{"line":88,"column":10},"end":{"line":88,"column":35}},"44":{"start":{"line":89,"column":10},"end":{"line":96,"column":11}},"45":{"start":{"line":90,"column":15},"end":{"line":93,"column":18}},"46":{"start":{"line":95,"column":15},"end":{"line":95,"column":45}},"47":{"start":{"line":97,"column":10},"end":{"line":103,"column":13}},"48":{"start":{"line":104,"column":10},"end":{"line":106,"column":11}},"49":{"start":{"line":105,"column":15},"end":{"line":105,"column":29}},"50":{"start":{"line":108,"column":5},"end":{"line":108,"column":28}},"51":{"start":{"line":111,"column":0},"end":{"line":114,"column":1}}},"branchMap":{"1":{"line":28,"type":"if","locations":[{"start":{"line":28,"column":25},"end":{"line":28,"column":25}},{"start":{"line":28,"column":25},"end":{"line":28,"column":25}}]},"2":{"line":43,"type":"if","locations":[{"start":{"line":43,"column":5},"end":{"line":43,"column":5}},{"start":{"line":43,"column":5},"end":{"line":43,"column":5}}]},"3":{"line":89,"type":"if","locations":[{"start":{"line":89,"column":10},"end":{"line":89,"column":10}},{"start":{"line":89,"column":10},"end":{"line":89,"column":10}}]},"4":{"line":89,"type":"binary-expr","locations":[{"start":{"line":89,"column":14},"end":{"line":89,"column":17}},{"start":{"line":89,"column":21},"end":{"line":89,"column":28}}]},"5":{"line":104,"type":"if","locations":[{"start":{"line":104,"column":10},"end":{"line":104,"column":10}},{"start":{"line":104,"column":10},"end":{"line":104,"column":10}}]},"6":{"line":104,"type":"binary-expr","locations":[{"start":{"line":104,"column":14},"end":{"line":104,"column":43}},{"start":{"line":104,"column":47},"end":{"line":104,"column":80}}]}}};
}
__cov_tDs8aMzJqqON2ifzOf8wgA = __cov_tDs8aMzJqqON2ifzOf8wgA['app/actions/mobileCaptures/index.js'];
__cov_tDs8aMzJqqON2ifzOf8wgA.s['1']++;var async=require('async');__cov_tDs8aMzJqqON2ifzOf8wgA.s['2']++;var sharp=require('sharp');__cov_tDs8aMzJqqON2ifzOf8wgA.s['3']++;var q=require('q');__cov_tDs8aMzJqqON2ifzOf8wgA.s['4']++;var phantom=require('node-phantom-simple');__cov_tDs8aMzJqqON2ifzOf8wgA.s['5']++;var utils=require('../sniff/utils');__cov_tDs8aMzJqqON2ifzOf8wgA.s['6']++;var saveImageToAWS=require('./saveCapture');function saveImage(page,filename,callback,errorCallback){__cov_tDs8aMzJqqON2ifzOf8wgA.f['1']++;__cov_tDs8aMzJqqON2ifzOf8wgA.s['8']++;var imageDir='./images/';__cov_tDs8aMzJqqON2ifzOf8wgA.s['9']++;var _filename=imageDir+filename;__cov_tDs8aMzJqqON2ifzOf8wgA.s['10']++;var thumbName=imageDir+'_thumb_'+filename;__cov_tDs8aMzJqqON2ifzOf8wgA.s['11']++;page.render(_filename,function(){__cov_tDs8aMzJqqON2ifzOf8wgA.f['2']++;__cov_tDs8aMzJqqON2ifzOf8wgA.s['12']++;sharp(_filename).resize(200).toFile(thumbName,function(err,info){__cov_tDs8aMzJqqON2ifzOf8wgA.f['3']++;__cov_tDs8aMzJqqON2ifzOf8wgA.s['13']++;saveImageToAWS(thumbName,function(err,url){__cov_tDs8aMzJqqON2ifzOf8wgA.f['4']++;__cov_tDs8aMzJqqON2ifzOf8wgA.s['14']++;if(err==='success'){__cov_tDs8aMzJqqON2ifzOf8wgA.b['1'][0]++;__cov_tDs8aMzJqqON2ifzOf8wgA.s['15']++;callback(url);}else{__cov_tDs8aMzJqqON2ifzOf8wgA.b['1'][1]++;__cov_tDs8aMzJqqON2ifzOf8wgA.s['16']++;errorCallback(err);}__cov_tDs8aMzJqqON2ifzOf8wgA.s['17']++;page.close();});});});}function doit(url,requestId,inputSizes){__cov_tDs8aMzJqqON2ifzOf8wgA.f['5']++;__cov_tDs8aMzJqqON2ifzOf8wgA.s['19']++;var promise=q.defer();__cov_tDs8aMzJqqON2ifzOf8wgA.s['20']++;console.log('url2',url);__cov_tDs8aMzJqqON2ifzOf8wgA.s['21']++;var sizes=['1920x1080','1600x1200','1400x900','1024x768','800x600','420x360'];__cov_tDs8aMzJqqON2ifzOf8wgA.s['22']++;if(typeof inputSizes!=='undefined'){__cov_tDs8aMzJqqON2ifzOf8wgA.b['2'][0]++;__cov_tDs8aMzJqqON2ifzOf8wgA.s['23']++;sizes=inputSizes;}else{__cov_tDs8aMzJqqON2ifzOf8wgA.b['2'][1]++;}__cov_tDs8aMzJqqON2ifzOf8wgA.s['24']++;var siteURL=url;__cov_tDs8aMzJqqON2ifzOf8wgA.s['25']++;var siteName=siteURL.replace('http://','');__cov_tDs8aMzJqqON2ifzOf8wgA.s['26']++;siteName=siteName.replace('.','_')+'_';__cov_tDs8aMzJqqON2ifzOf8wgA.s['27']++;var imageDir='./images/';function scrot(_sizes,callback){__cov_tDs8aMzJqqON2ifzOf8wgA.f['6']++;__cov_tDs8aMzJqqON2ifzOf8wgA.s['29']++;size=_sizes.split('x');__cov_tDs8aMzJqqON2ifzOf8wgA.s['30']++;phantom.create().then(function(ph){__cov_tDs8aMzJqqON2ifzOf8wgA.f['7']++;__cov_tDs8aMzJqqON2ifzOf8wgA.s['31']++;utils.promisify(ph.createPage)().then(function(page){__cov_tDs8aMzJqqON2ifzOf8wgA.f['8']++;__cov_tDs8aMzJqqON2ifzOf8wgA.s['32']++;page.set('viewportSize',{width:size[0],height:size[1]});__cov_tDs8aMzJqqON2ifzOf8wgA.s['33']++;page.set('zoomFactor',1);__cov_tDs8aMzJqqON2ifzOf8wgA.s['34']++;page.open(siteURL,function(status){__cov_tDs8aMzJqqON2ifzOf8wgA.f['9']++;__cov_tDs8aMzJqqON2ifzOf8wgA.s['35']++;console.log('Opened!');__cov_tDs8aMzJqqON2ifzOf8wgA.s['36']++;var filename=siteName+size[0]+'x'+size[1]+'.png';__cov_tDs8aMzJqqON2ifzOf8wgA.s['37']++;saveImage(filename,page,function(url){__cov_tDs8aMzJqqON2ifzOf8wgA.f['10']++;__cov_tDs8aMzJqqON2ifzOf8wgA.s['38']++;callback({err:null,ph:ph,size:_sizes,url:url});},function(err){__cov_tDs8aMzJqqON2ifzOf8wgA.f['11']++;__cov_tDs8aMzJqqON2ifzOf8wgA.s['39']++;callback({err:err,ph:ph,size:_sizes});});});}).then(function(){__cov_tDs8aMzJqqON2ifzOf8wgA.f['12']++;__cov_tDs8aMzJqqON2ifzOf8wgA.s['40']++;console.log('done 2');}).finally(function(){__cov_tDs8aMzJqqON2ifzOf8wgA.f['13']++;__cov_tDs8aMzJqqON2ifzOf8wgA.s['41']++;console.log('done');});});}__cov_tDs8aMzJqqON2ifzOf8wgA.s['42']++;async.eachSeries(sizes,scrot,function(res){__cov_tDs8aMzJqqON2ifzOf8wgA.f['14']++;__cov_tDs8aMzJqqON2ifzOf8wgA.s['43']++;console.log('done',res);__cov_tDs8aMzJqqON2ifzOf8wgA.s['44']++;if((__cov_tDs8aMzJqqON2ifzOf8wgA.b['4'][0]++,res)&&(__cov_tDs8aMzJqqON2ifzOf8wgA.b['4'][1]++,res.err)){__cov_tDs8aMzJqqON2ifzOf8wgA.b['3'][0]++;__cov_tDs8aMzJqqON2ifzOf8wgA.s['45']++;promise.reject({status:'error',data:'Captures not taken'});}else{__cov_tDs8aMzJqqON2ifzOf8wgA.b['3'][1]++;__cov_tDs8aMzJqqON2ifzOf8wgA.s['46']++;console.log('done, quitting');}__cov_tDs8aMzJqqON2ifzOf8wgA.s['47']++;promise.resolve({status:'success',size:res.size,url:res.url,requestId:requestId,data:'Captures taken'});__cov_tDs8aMzJqqON2ifzOf8wgA.s['48']++;if((__cov_tDs8aMzJqqON2ifzOf8wgA.b['6'][0]++,typeof res.ph!=='undefined')&&(__cov_tDs8aMzJqqON2ifzOf8wgA.b['6'][1]++,typeof res.ph.exit==='function')){__cov_tDs8aMzJqqON2ifzOf8wgA.b['5'][0]++;__cov_tDs8aMzJqqON2ifzOf8wgA.s['49']++;res.ph.exit();}else{__cov_tDs8aMzJqqON2ifzOf8wgA.b['5'][1]++;}});__cov_tDs8aMzJqqON2ifzOf8wgA.s['50']++;return promise.promise;}__cov_tDs8aMzJqqON2ifzOf8wgA.s['51']++;module.exports={doit:doit,saveImage:saveImage};
