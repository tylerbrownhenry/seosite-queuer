
var __cov_WI02AiyWqQMoTv0bc788cQ = (Function('return this'))();
if (!__cov_WI02AiyWqQMoTv0bc788cQ.__coverage__) { __cov_WI02AiyWqQMoTv0bc788cQ.__coverage__ = {}; }
__cov_WI02AiyWqQMoTv0bc788cQ = __cov_WI02AiyWqQMoTv0bc788cQ.__coverage__;
if (!(__cov_WI02AiyWqQMoTv0bc788cQ['app/settings/requests/retry.js'])) {
   __cov_WI02AiyWqQMoTv0bc788cQ['app/settings/requests/retry.js'] = {"path":"app/settings/requests/retry.js","s":{"1":0,"2":1,"3":0,"4":0,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":1,"16":1,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0},"fnMap":{"1":{"name":"originalIssueResolved","line":9,"loc":{"start":{"line":9,"column":0},"end":{"line":9,"column":37}}},"2":{"name":"publish","line":18,"loc":{"start":{"line":18,"column":0},"end":{"line":18,"column":24}}},"3":{"name":"start","line":43,"loc":{"start":{"line":43,"column":0},"end":{"line":43,"column":19}}},"4":{"name":"init","line":47,"loc":{"start":{"line":47,"column":0},"end":{"line":47,"column":19}}},"5":{"name":"(anonymous_5)","line":50,"loc":{"start":{"line":50,"column":41},"end":{"line":50,"column":65}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":7,"column":69}},"2":{"start":{"line":9,"column":0},"end":{"line":16,"column":1}},"3":{"start":{"line":10,"column":5},"end":{"line":15,"column":6}},"4":{"start":{"line":14,"column":10},"end":{"line":14,"column":22}},"5":{"start":{"line":18,"column":0},"end":{"line":41,"column":1}},"6":{"start":{"line":19,"column":5},"end":{"line":27,"column":7}},"7":{"start":{"line":28,"column":5},"end":{"line":36,"column":6}},"8":{"start":{"line":29,"column":10},"end":{"line":33,"column":13}},"9":{"start":{"line":34,"column":10},"end":{"line":34,"column":28}},"10":{"start":{"line":35,"column":10},"end":{"line":35,"column":33}},"11":{"start":{"line":37,"column":5},"end":{"line":37,"column":42}},"12":{"start":{"line":38,"column":5},"end":{"line":38,"column":42}},"13":{"start":{"line":39,"column":5},"end":{"line":39,"column":50}},"14":{"start":{"line":40,"column":5},"end":{"line":40,"column":46}},"15":{"start":{"line":43,"column":0},"end":{"line":45,"column":1}},"16":{"start":{"line":47,"column":0},"end":{"line":92,"column":1}},"17":{"start":{"line":48,"column":5},"end":{"line":48,"column":29}},"18":{"start":{"line":50,"column":5},"end":{"line":58,"column":8}},"19":{"start":{"line":51,"column":10},"end":{"line":55,"column":13}},"20":{"start":{"line":56,"column":10},"end":{"line":56,"column":28}},"21":{"start":{"line":57,"column":10},"end":{"line":57,"column":33}},"22":{"start":{"line":60,"column":5},"end":{"line":68,"column":6}},"23":{"start":{"line":61,"column":10},"end":{"line":65,"column":13}},"24":{"start":{"line":66,"column":10},"end":{"line":66,"column":28}},"25":{"start":{"line":67,"column":10},"end":{"line":67,"column":33}},"26":{"start":{"line":70,"column":5},"end":{"line":78,"column":6}},"27":{"start":{"line":71,"column":10},"end":{"line":75,"column":13}},"28":{"start":{"line":76,"column":10},"end":{"line":76,"column":27}},"29":{"start":{"line":77,"column":10},"end":{"line":77,"column":33}},"30":{"start":{"line":80,"column":5},"end":{"line":90,"column":6}},"31":{"start":{"line":81,"column":10},"end":{"line":85,"column":13}},"32":{"start":{"line":86,"column":10},"end":{"line":86,"column":28}},"33":{"start":{"line":87,"column":10},"end":{"line":87,"column":33}},"34":{"start":{"line":89,"column":10},"end":{"line":89,"column":70}},"35":{"start":{"line":91,"column":5},"end":{"line":91,"column":28}},"36":{"start":{"line":94,"column":0},"end":{"line":94,"column":27}},"37":{"start":{"line":95,"column":0},"end":{"line":95,"column":61}}},"branchMap":{"1":{"line":10,"type":"if","locations":[{"start":{"line":10,"column":5},"end":{"line":10,"column":5}},{"start":{"line":10,"column":5},"end":{"line":10,"column":5}}]},"2":{"line":20,"type":"binary-expr","locations":[{"start":{"line":20,"column":15},"end":{"line":20,"column":24}},{"start":{"line":20,"column":28},"end":{"line":20,"column":32}}]},"3":{"line":21,"type":"binary-expr","locations":[{"start":{"line":21,"column":16},"end":{"line":21,"column":26}},{"start":{"line":21,"column":30},"end":{"line":21,"column":34}}]},"4":{"line":22,"type":"binary-expr","locations":[{"start":{"line":22,"column":15},"end":{"line":22,"column":24}},{"start":{"line":22,"column":28},"end":{"line":22,"column":32}}]},"5":{"line":23,"type":"binary-expr","locations":[{"start":{"line":23,"column":16},"end":{"line":23,"column":26}},{"start":{"line":23,"column":30},"end":{"line":23,"column":34}}]},"6":{"line":24,"type":"binary-expr","locations":[{"start":{"line":24,"column":18},"end":{"line":24,"column":30}},{"start":{"line":24,"column":34},"end":{"line":24,"column":38}}]},"7":{"line":25,"type":"binary-expr","locations":[{"start":{"line":25,"column":22},"end":{"line":25,"column":38}},{"start":{"line":25,"column":42},"end":{"line":25,"column":46}}]},"8":{"line":28,"type":"if","locations":[{"start":{"line":28,"column":5},"end":{"line":28,"column":5}},{"start":{"line":28,"column":5},"end":{"line":28,"column":5}}]},"9":{"line":60,"type":"if","locations":[{"start":{"line":60,"column":5},"end":{"line":60,"column":5}},{"start":{"line":60,"column":5},"end":{"line":60,"column":5}}]},"10":{"line":70,"type":"if","locations":[{"start":{"line":70,"column":5},"end":{"line":70,"column":5}},{"start":{"line":70,"column":5},"end":{"line":70,"column":5}}]},"11":{"line":80,"type":"if","locations":[{"start":{"line":80,"column":5},"end":{"line":80,"column":5}},{"start":{"line":80,"column":5},"end":{"line":80,"column":5}}]}}};
}
__cov_WI02AiyWqQMoTv0bc788cQ = __cov_WI02AiyWqQMoTv0bc788cQ['app/settings/requests/retry.js'];
__cov_WI02AiyWqQMoTv0bc788cQ.s['1']++;var sh=require('shorthash'),publisher=require('../../amqp-connections/publisher'),logError=require('../../actions/logError'),utils=require('../../utils'),q=require('q'),retryables=require('./retry/retryables'),preFlight=require('../../amqp-connections/helpers/preFlight');function originalIssueResolved(type){__cov_WI02AiyWqQMoTv0bc788cQ.f['1']++;__cov_WI02AiyWqQMoTv0bc788cQ.s['3']++;if(type==='database'){__cov_WI02AiyWqQMoTv0bc788cQ.b['1'][0]++;__cov_WI02AiyWqQMoTv0bc788cQ.s['4']++;return true;}else{__cov_WI02AiyWqQMoTv0bc788cQ.b['1'][1]++;}}function publish(input){__cov_WI02AiyWqQMoTv0bc788cQ.f['2']++;__cov_WI02AiyWqQMoTv0bc788cQ.s['6']++;var msg={uid:(__cov_WI02AiyWqQMoTv0bc788cQ.b['2'][0]++,input.uid)||(__cov_WI02AiyWqQMoTv0bc788cQ.b['2'][1]++,null),i_id:(__cov_WI02AiyWqQMoTv0bc788cQ.b['3'][0]++,input.i_id)||(__cov_WI02AiyWqQMoTv0bc788cQ.b['3'][1]++,null),url:(__cov_WI02AiyWqQMoTv0bc788cQ.b['4'][0]++,input.url)||(__cov_WI02AiyWqQMoTv0bc788cQ.b['4'][1]++,null),page:(__cov_WI02AiyWqQMoTv0bc788cQ.b['5'][0]++,input.page)||(__cov_WI02AiyWqQMoTv0bc788cQ.b['5'][1]++,null),status:(__cov_WI02AiyWqQMoTv0bc788cQ.b['6'][0]++,input.status)||(__cov_WI02AiyWqQMoTv0bc788cQ.b['6'][1]++,null),statusType:(__cov_WI02AiyWqQMoTv0bc788cQ.b['7'][0]++,input.statusType)||(__cov_WI02AiyWqQMoTv0bc788cQ.b['7'][1]++,null),isRetry:true};__cov_WI02AiyWqQMoTv0bc788cQ.s['7']++;if(utils.checkRequirements(input,['requestId','retryCommand','retryOptions'])===true){__cov_WI02AiyWqQMoTv0bc788cQ.b['8'][0]++;__cov_WI02AiyWqQMoTv0bc788cQ.s['8']++;logError({where:'retry.js:publish:checkRequirements',with:msg,error:'requirements not met.'});__cov_WI02AiyWqQMoTv0bc788cQ.s['9']++;promise.resolve();__cov_WI02AiyWqQMoTv0bc788cQ.s['10']++;return promise.promise;}else{__cov_WI02AiyWqQMoTv0bc788cQ.b['8'][1]++;}__cov_WI02AiyWqQMoTv0bc788cQ.s['11']++;msg.retryCommand=input.retryCommand;__cov_WI02AiyWqQMoTv0bc788cQ.s['12']++;msg.retryOptions=input.retryOptions;__cov_WI02AiyWqQMoTv0bc788cQ.s['13']++;var buffer=new Buffer(JSON.stringify(msg));__cov_WI02AiyWqQMoTv0bc788cQ.s['14']++;publisher.publish('','retries',buffer);}function start(msg){__cov_WI02AiyWqQMoTv0bc788cQ.f['3']++;}function init(msg){__cov_WI02AiyWqQMoTv0bc788cQ.f['4']++;__cov_WI02AiyWqQMoTv0bc788cQ.s['17']++;var promise=q.defer();__cov_WI02AiyWqQMoTv0bc788cQ.s['18']++;var input=preFlight(promise,msg,function(promise,err){__cov_WI02AiyWqQMoTv0bc788cQ.f['5']++;__cov_WI02AiyWqQMoTv0bc788cQ.s['19']++;logError({where:'retry.js:preFlight',with:msg,error:err});__cov_WI02AiyWqQMoTv0bc788cQ.s['20']++;promise.resolve();__cov_WI02AiyWqQMoTv0bc788cQ.s['21']++;return promise.promise;});__cov_WI02AiyWqQMoTv0bc788cQ.s['22']++;if(utils.checkRequirements(input,['i_id','retryCommand','retryOptions'])===true){__cov_WI02AiyWqQMoTv0bc788cQ.b['9'][0]++;__cov_WI02AiyWqQMoTv0bc788cQ.s['23']++;logError({where:'retry.js:checkRequirements',with:msg,error:'requirements not met.'});__cov_WI02AiyWqQMoTv0bc788cQ.s['24']++;promise.resolve();__cov_WI02AiyWqQMoTv0bc788cQ.s['25']++;return promise.promise;}else{__cov_WI02AiyWqQMoTv0bc788cQ.b['9'][1]++;}__cov_WI02AiyWqQMoTv0bc788cQ.s['26']++;if(originalIssueResolved(input.statusType)===false){__cov_WI02AiyWqQMoTv0bc788cQ.b['10'][0]++;__cov_WI02AiyWqQMoTv0bc788cQ.s['27']++;logError({where:'retry.js:originProblemResolved',with:msg,error:'original failed issue is still present, issue: '+input.statusType});__cov_WI02AiyWqQMoTv0bc788cQ.s['28']++;promise.reject();__cov_WI02AiyWqQMoTv0bc788cQ.s['29']++;return promise.promise;}else{__cov_WI02AiyWqQMoTv0bc788cQ.b['10'][1]++;}__cov_WI02AiyWqQMoTv0bc788cQ.s['30']++;if(typeof retryables[input.retryCommand]==='undefined'){__cov_WI02AiyWqQMoTv0bc788cQ.b['11'][0]++;__cov_WI02AiyWqQMoTv0bc788cQ.s['31']++;logError({where:'retry.js:check if command exists',with:msg,error:'attempt to retry a command not list as retryable,command : '+input.retryCommand});__cov_WI02AiyWqQMoTv0bc788cQ.s['32']++;promise.resolve();__cov_WI02AiyWqQMoTv0bc788cQ.s['33']++;return promise.promise;}else{__cov_WI02AiyWqQMoTv0bc788cQ.b['11'][1]++;__cov_WI02AiyWqQMoTv0bc788cQ.s['34']++;retryables[input.retryCommand](promise,input.retryOptions);}__cov_WI02AiyWqQMoTv0bc788cQ.s['35']++;return promise.promise;}__cov_WI02AiyWqQMoTv0bc788cQ.s['36']++;module.exports.init=init;__cov_WI02AiyWqQMoTv0bc788cQ.s['37']++;module.exports.originalIssueResolved=originalIssueResolved;
