
var __cov_WFmV28x_eV0p5n$mKkBOIg = (Function('return this'))();
if (!__cov_WFmV28x_eV0p5n$mKkBOIg.__coverage__) { __cov_WFmV28x_eV0p5n$mKkBOIg.__coverage__ = {}; }
__cov_WFmV28x_eV0p5n$mKkBOIg = __cov_WFmV28x_eV0p5n$mKkBOIg.__coverage__;
if (!(__cov_WFmV28x_eV0p5n$mKkBOIg['app/settings/requests/link.js'])) {
   __cov_WFmV28x_eV0p5n$mKkBOIg['app/settings/requests/link.js'] = {"path":"app/settings/requests/link.js","s":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":1,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0,0,0],"4":[0,0],"5":[0,0,0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0,0],"10":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},"fnMap":{"1":{"name":"linkRequest","line":11,"loc":{"start":{"line":11,"column":0},"end":{"line":11,"column":26}}},"2":{"name":"(anonymous_2)","line":18,"loc":{"start":{"line":18,"column":13},"end":{"line":18,"column":33}}},"3":{"name":"(anonymous_3)","line":74,"loc":{"start":{"line":74,"column":15},"end":{"line":74,"column":28}}},"4":{"name":"(anonymous_4)","line":100,"loc":{"start":{"line":100,"column":30},"end":{"line":100,"column":51}}},"5":{"name":"(anonymous_5)","line":143,"loc":{"start":{"line":143,"column":43},"end":{"line":143,"column":64}}},"6":{"name":"(anonymous_6)","line":151,"loc":{"start":{"line":151,"column":53},"end":{"line":151,"column":68}}},"7":{"name":"(anonymous_7)","line":202,"loc":{"start":{"line":202,"column":14},"end":{"line":202,"column":29}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":37}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":64}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":46}},"4":{"start":{"line":4,"column":0},"end":{"line":4,"column":52}},"5":{"start":{"line":5,"column":0},"end":{"line":5,"column":47}},"6":{"start":{"line":6,"column":0},"end":{"line":6,"column":56}},"7":{"start":{"line":7,"column":0},"end":{"line":7,"column":47}},"8":{"start":{"line":8,"column":0},"end":{"line":8,"column":35}},"9":{"start":{"line":9,"column":0},"end":{"line":9,"column":21}},"10":{"start":{"line":11,"column":0},"end":{"line":206,"column":1}},"11":{"start":{"line":12,"column":5},"end":{"line":12,"column":29}},"12":{"start":{"line":13,"column":5},"end":{"line":13,"column":40}},"13":{"start":{"line":14,"column":5},"end":{"line":204,"column":7}},"14":{"start":{"line":19,"column":10},"end":{"line":19,"column":91}},"15":{"start":{"line":20,"column":10},"end":{"line":20,"column":76}},"16":{"start":{"line":21,"column":10},"end":{"line":38,"column":12}},"17":{"start":{"line":40,"column":10},"end":{"line":48,"column":11}},"18":{"start":{"line":41,"column":15},"end":{"line":41,"column":46}},"19":{"start":{"line":42,"column":15},"end":{"line":42,"column":58}},"20":{"start":{"line":43,"column":15},"end":{"line":43,"column":60}},"21":{"start":{"line":44,"column":15},"end":{"line":44,"column":50}},"22":{"start":{"line":45,"column":15},"end":{"line":45,"column":62}},"23":{"start":{"line":50,"column":10},"end":{"line":52,"column":11}},"24":{"start":{"line":51,"column":15},"end":{"line":51,"column":66}},"25":{"start":{"line":54,"column":10},"end":{"line":59,"column":11}},"26":{"start":{"line":55,"column":15},"end":{"line":55,"column":86}},"27":{"start":{"line":56,"column":15},"end":{"line":56,"column":90}},"28":{"start":{"line":57,"column":15},"end":{"line":57,"column":68}},"29":{"start":{"line":58,"column":15},"end":{"line":58,"column":74}},"30":{"start":{"line":61,"column":10},"end":{"line":201,"column":18}},"31":{"start":{"line":75,"column":20},"end":{"line":200,"column":21}},"32":{"start":{"line":76,"column":25},"end":{"line":76,"column":65}},"33":{"start":{"line":82,"column":25},"end":{"line":82,"column":46}},"34":{"start":{"line":84,"column":25},"end":{"line":84,"column":71}},"35":{"start":{"line":91,"column":25},"end":{"line":199,"column":33}},"36":{"start":{"line":102,"column":35},"end":{"line":198,"column":36}},"37":{"start":{"line":131,"column":40},"end":{"line":138,"column":43}},"38":{"start":{"line":141,"column":40},"end":{"line":197,"column":43}},"39":{"start":{"line":144,"column":45},"end":{"line":196,"column":46}},"40":{"start":{"line":145,"column":50},"end":{"line":193,"column":53}},"41":{"start":{"line":152,"column":55},"end":{"line":192,"column":56}},"42":{"start":{"line":153,"column":60},"end":{"line":160,"column":63}},"43":{"start":{"line":169,"column":60},"end":{"line":169,"column":82}},"44":{"start":{"line":170,"column":60},"end":{"line":170,"column":89}},"45":{"start":{"line":172,"column":60},"end":{"line":191,"column":63}},"46":{"start":{"line":195,"column":50},"end":{"line":195,"column":72}},"47":{"start":{"line":203,"column":10},"end":{"line":203,"column":49}},"48":{"start":{"line":205,"column":5},"end":{"line":205,"column":28}},"49":{"start":{"line":207,"column":0},"end":{"line":207,"column":29}}},"branchMap":{"1":{"line":40,"type":"if","locations":[{"start":{"line":40,"column":10},"end":{"line":40,"column":10}},{"start":{"line":40,"column":10},"end":{"line":40,"column":10}}]},"2":{"line":50,"type":"if","locations":[{"start":{"line":50,"column":10},"end":{"line":50,"column":10}},{"start":{"line":50,"column":10},"end":{"line":50,"column":10}}]},"3":{"line":50,"type":"binary-expr","locations":[{"start":{"line":50,"column":14},"end":{"line":50,"column":22}},{"start":{"line":50,"column":26},"end":{"line":50,"column":38}},{"start":{"line":50,"column":42},"end":{"line":50,"column":61}},{"start":{"line":50,"column":65},"end":{"line":50,"column":90}}]},"4":{"line":54,"type":"if","locations":[{"start":{"line":54,"column":10},"end":{"line":54,"column":10}},{"start":{"line":54,"column":10},"end":{"line":54,"column":10}}]},"5":{"line":54,"type":"binary-expr","locations":[{"start":{"line":54,"column":14},"end":{"line":54,"column":22}},{"start":{"line":54,"column":26},"end":{"line":54,"column":39}},{"start":{"line":54,"column":43},"end":{"line":54,"column":65}},{"start":{"line":54,"column":69},"end":{"line":54,"column":99}}]},"6":{"line":75,"type":"if","locations":[{"start":{"line":75,"column":20},"end":{"line":75,"column":20}},{"start":{"line":75,"column":20},"end":{"line":75,"column":20}}]},"7":{"line":102,"type":"if","locations":[{"start":{"line":102,"column":35},"end":{"line":102,"column":35}},{"start":{"line":102,"column":35},"end":{"line":102,"column":35}}]},"8":{"line":144,"type":"if","locations":[{"start":{"line":144,"column":45},"end":{"line":144,"column":45}},{"start":{"line":144,"column":45},"end":{"line":144,"column":45}}]},"9":{"line":144,"type":"binary-expr","locations":[{"start":{"line":144,"column":49},"end":{"line":144,"column":53}},{"start":{"line":144,"column":58},"end":{"line":144,"column":78}},{"start":{"line":144,"column":82},"end":{"line":144,"column":100}}]},"10":{"line":152,"type":"if","locations":[{"start":{"line":152,"column":55},"end":{"line":152,"column":55}},{"start":{"line":152,"column":55},"end":{"line":152,"column":55}}]}}};
}
__cov_WFmV28x_eV0p5n$mKkBOIg = __cov_WFmV28x_eV0p5n$mKkBOIg['app/settings/requests/link.js'];
__cov_WFmV28x_eV0p5n$mKkBOIg.s['1']++;var dynamoose=require('dynamoose');__cov_WFmV28x_eV0p5n$mKkBOIg.s['2']++;var linkScanner=require('../../actions/scanPage/linkScanner');__cov_WFmV28x_eV0p5n$mKkBOIg.s['3']++;var linkSchema=require('../../models/link');__cov_WFmV28x_eV0p5n$mKkBOIg.s['4']++;var requestSchema=require('../../models/request');__cov_WFmV28x_eV0p5n$mKkBOIg.s['5']++;var Link=dynamoose.model('Link',linkSchema);__cov_WFmV28x_eV0p5n$mKkBOIg.s['6']++;var Request=dynamoose.model('Request',requestSchema);__cov_WFmV28x_eV0p5n$mKkBOIg.s['7']++;var notify=require('../../actions/callback');__cov_WFmV28x_eV0p5n$mKkBOIg.s['8']++;var utils=require('../../utils');__cov_WFmV28x_eV0p5n$mKkBOIg.s['9']++;var q=require('q');function linkRequest(msg){__cov_WFmV28x_eV0p5n$mKkBOIg.f['1']++;__cov_WFmV28x_eV0p5n$mKkBOIg.s['11']++;var promise=q.defer();__cov_WFmV28x_eV0p5n$mKkBOIg.s['12']++;var link=JSON.parse(msg.content);__cov_WFmV28x_eV0p5n$mKkBOIg.s['13']++;linkScanner.init({_link:link._link,url:link.url,baseUrl:link.baseUrl}).then(function(response){__cov_WFmV28x_eV0p5n$mKkBOIg.f['2']++;__cov_WFmV28x_eV0p5n$mKkBOIg.s['14']++;console.log('linkRequest responsee',link.linkId,'link.requestId',link.requestId);__cov_WFmV28x_eV0p5n$mKkBOIg.s['15']++;console.log('linkRequest responsee',link._link,'msg',response);__cov_WFmV28x_eV0p5n$mKkBOIg.s['16']++;var input={selector:link._link.html.selector,tag:link._link.html.tag,tagName:link._link.html.tagName,internal:response.internal,samePage:response.samePage,linkId:link.linkId,uid:link.uid,requestId:link.requestId};__cov_WFmV28x_eV0p5n$mKkBOIg.s['17']++;if(response.broken===true){__cov_WFmV28x_eV0p5n$mKkBOIg.b['1'][0]++;__cov_WFmV28x_eV0p5n$mKkBOIg.s['18']++;input.broken=response.broken;__cov_WFmV28x_eV0p5n$mKkBOIg.s['19']++;input.brokenReason=response.brokenReason;__cov_WFmV28x_eV0p5n$mKkBOIg.s['20']++;input._brokenReason=response._brokenReason;__cov_WFmV28x_eV0p5n$mKkBOIg.s['21']++;input.excluded=response.excluded;__cov_WFmV28x_eV0p5n$mKkBOIg.s['22']++;input.excludedReason=response.excludedReason;}else{__cov_WFmV28x_eV0p5n$mKkBOIg.b['1'][1]++;}__cov_WFmV28x_eV0p5n$mKkBOIg.s['23']++;if((__cov_WFmV28x_eV0p5n$mKkBOIg.b['3'][0]++,response)&&(__cov_WFmV28x_eV0p5n$mKkBOIg.b['3'][1]++,response.url)&&(__cov_WFmV28x_eV0p5n$mKkBOIg.b['3'][2]++,response.url.parsed)&&(__cov_WFmV28x_eV0p5n$mKkBOIg.b['3'][3]++,response.url.parsed.extra)){__cov_WFmV28x_eV0p5n$mKkBOIg.b['2'][0]++;__cov_WFmV28x_eV0p5n$mKkBOIg.s['24']++;input.filename=response.url.parsed.extra.filename;}else{__cov_WFmV28x_eV0p5n$mKkBOIg.b['2'][1]++;}__cov_WFmV28x_eV0p5n$mKkBOIg.s['25']++;if((__cov_WFmV28x_eV0p5n$mKkBOIg.b['5'][0]++,response)&&(__cov_WFmV28x_eV0p5n$mKkBOIg.b['5'][1]++,response.http)&&(__cov_WFmV28x_eV0p5n$mKkBOIg.b['5'][2]++,response.http.response)&&(__cov_WFmV28x_eV0p5n$mKkBOIg.b['5'][3]++,response.http.response.headers)){__cov_WFmV28x_eV0p5n$mKkBOIg.b['4'][0]++;__cov_WFmV28x_eV0p5n$mKkBOIg.s['26']++;input['content-type']=response.http.response.headers['content-type'];__cov_WFmV28x_eV0p5n$mKkBOIg.s['27']++;input['content-length']=response.http.response.headers['content-length'];__cov_WFmV28x_eV0p5n$mKkBOIg.s['28']++;input.statusCode=response.http.response.statusCode;__cov_WFmV28x_eV0p5n$mKkBOIg.s['29']++;input.statusMessage=response.http.response.statusMessage;}else{__cov_WFmV28x_eV0p5n$mKkBOIg.b['4'][1]++;}__cov_WFmV28x_eV0p5n$mKkBOIg.s['30']++;utils.updateBy(Link,{linkId:link.linkId},{$set:{status:'complete',results:input,_dev_use_only_input:input,_dev_use_only_link:link},$unset:{__link:''}},function(e){__cov_WFmV28x_eV0p5n$mKkBOIg.f['3']++;__cov_WFmV28x_eV0p5n$mKkBOIg.s['31']++;if(e){__cov_WFmV28x_eV0p5n$mKkBOIg.b['6'][0]++;__cov_WFmV28x_eV0p5n$mKkBOIg.s['32']++;console.log('save link update error',e);__cov_WFmV28x_eV0p5n$mKkBOIg.s['33']++;promise.reject(true);}else{__cov_WFmV28x_eV0p5n$mKkBOIg.b['6'][1]++;__cov_WFmV28x_eV0p5n$mKkBOIg.s['34']++;console.log('save link updated!',link.linkId);__cov_WFmV28x_eV0p5n$mKkBOIg.s['35']++;utils.updateBy(Request,{requestId:link.requestId},{$ADD:{processes:-1}},function(err,data){__cov_WFmV28x_eV0p5n$mKkBOIg.f['4']++;__cov_WFmV28x_eV0p5n$mKkBOIg.s['36']++;if(err){__cov_WFmV28x_eV0p5n$mKkBOIg.b['7'][0]++;__cov_WFmV28x_eV0p5n$mKkBOIg.s['37']++;promise.reject({system:'mongo',requestId:link.requestId,status:'error',message:'Error updating count after finishing a link from a request. Error: '+err,requestId:link.requestId,func:'Request.collection.findOneAndUpdate'});}else{__cov_WFmV28x_eV0p5n$mKkBOIg.b['7'][1]++;__cov_WFmV28x_eV0p5n$mKkBOIg.s['38']++;Request.get({requestId:link.requestId},function(err,data){__cov_WFmV28x_eV0p5n$mKkBOIg.f['5']++;__cov_WFmV28x_eV0p5n$mKkBOIg.s['39']++;if((__cov_WFmV28x_eV0p5n$mKkBOIg.b['9'][0]++,data)&&((__cov_WFmV28x_eV0p5n$mKkBOIg.b['9'][1]++,data.processes===0)||(__cov_WFmV28x_eV0p5n$mKkBOIg.b['9'][2]++,data.processes<0))){__cov_WFmV28x_eV0p5n$mKkBOIg.b['8'][0]++;__cov_WFmV28x_eV0p5n$mKkBOIg.s['40']++;utils.updateBy({requestId:link.requestId},{$PUT:{status:'completed'}},function(err){__cov_WFmV28x_eV0p5n$mKkBOIg.f['6']++;__cov_WFmV28x_eV0p5n$mKkBOIg.s['41']++;if(err){__cov_WFmV28x_eV0p5n$mKkBOIg.b['10'][0]++;__cov_WFmV28x_eV0p5n$mKkBOIg.s['42']++;promise.reject({system:'mongo',requestId:link.requestId,status:'error',message:'Request has been completed, encountered an error closing it. Error: '+err,requestId:link.requestId,func:'Request.collection.findOneAndUpdate'});}else{__cov_WFmV28x_eV0p5n$mKkBOIg.b['10'][1]++;__cov_WFmV28x_eV0p5n$mKkBOIg.s['43']++;promise.resolve(true);__cov_WFmV28x_eV0p5n$mKkBOIg.s['44']++;console.log('Scan complete');__cov_WFmV28x_eV0p5n$mKkBOIg.s['45']++;notify({message:'Scan complete!',uid:link.uid,page:'/dashboard',type:'request',status:'complete',i_id:link.requestId});}});}else{__cov_WFmV28x_eV0p5n$mKkBOIg.b['8'][1]++;__cov_WFmV28x_eV0p5n$mKkBOIg.s['46']++;promise.resolve(true);}});}});}});}).catch(function(err){__cov_WFmV28x_eV0p5n$mKkBOIg.f['7']++;__cov_WFmV28x_eV0p5n$mKkBOIg.s['47']++;console.error('link request err',err);});__cov_WFmV28x_eV0p5n$mKkBOIg.s['48']++;return promise.promise;}__cov_WFmV28x_eV0p5n$mKkBOIg.s['49']++;module.exports=linkRequest;
